<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Swanpass â€” Map</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<style>
:root{--black:#0a0a0a;--black2:#111111;--card-bg:#161616;--red:#e8142a;--red-dark:#b80f20;--white:#fff;--white70:rgba(255,255,255,.7);--white40:rgba(255,255,255,.4);--white10:rgba(255,255,255,.08);--gold:#d4a847;--green:#22c55e;--border:rgba(255,255,255,.08);--radius:10px;}
*{margin:0;padding:0;box-sizing:border-box;}
body{background:var(--black);color:var(--white);font-family:'DM Sans',sans-serif;font-size:14px;height:100vh;overflow:hidden;display:flex;flex-direction:column;}
header{background:var(--black);border-bottom:1px solid var(--border);padding:0 16px;flex-shrink:0;}
.logo-img{height:28px;display:block;}
.header-inner{display:flex;align-items:center;gap:12px;height:52px;}
.logo-img{height:28px;display:block;}

.filter-bar{background:var(--black2);border-bottom:1px solid var(--border);padding:8px 16px;flex-shrink:0;display:flex;gap:8px;overflow-x:auto;scrollbar-width:none;align-items:center;}
.filter-bar::-webkit-scrollbar{display:none;}
.filter-pill{display:flex;align-items:center;gap:4px;background:var(--white10);border:1px solid var(--border);border-radius:20px;padding:5px 12px;font-size:12px;font-weight:500;white-space:nowrap;cursor:pointer;transition:all .2s;flex-shrink:0;color:var(--white70);}
.filter-pill:hover,.filter-pill.active{background:var(--red);border-color:var(--red);color:var(--white);}
.filter-divider{width:1px;height:20px;background:var(--border);flex-shrink:0;}
.filter-search{display:flex;align-items:center;gap:6px;background:var(--white10);border:1px solid var(--border);border-radius:20px;padding:5px 12px;flex-shrink:0;}
.filter-search input{background:none;border:none;outline:none;color:var(--white);font-family:'DM Sans',sans-serif;font-size:12px;width:130px;}
.filter-search input::placeholder{color:var(--white40);}
.main{flex:1;display:flex;overflow:hidden;position:relative;}
#map{flex:1;}
.leaflet-container{background:#1a1a1a!important;}
.emoji-pin{font-size:24px;cursor:pointer;filter:drop-shadow(0 2px 6px rgba(0,0,0,.9));transition:transform .15s;line-height:1;display:block;}
.emoji-pin:hover{transform:scale(1.35);}
.sidebar{width:300px;flex-shrink:0;background:var(--black2);border-left:1px solid var(--border);display:flex;flex-direction:column;overflow:hidden;}
.sidebar-header{padding:12px 16px;border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;flex-shrink:0;}
.sidebar-title{font-family:'Bebas Neue',sans-serif;font-size:16px;letter-spacing:1px;}
.result-count{font-size:11px;color:var(--white40);}
.sidebar-list{flex:1;overflow-y:auto;scrollbar-width:thin;scrollbar-color:var(--border) transparent;}
.list-item{padding:10px 14px;border-bottom:1px solid var(--border);cursor:pointer;transition:background .15s;display:flex;gap:10px;align-items:flex-start;}
.list-item:hover{background:var(--white10);}
.list-item.active{background:rgba(232,20,42,.1);border-left:3px solid var(--red);}
.list-thumb{width:50px;height:50px;border-radius:6px;object-fit:cover;flex-shrink:0;background:var(--black);}
.list-info{flex:1;min-width:0;}
.list-name{font-size:12px;font-weight:600;margin-bottom:2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.list-meta{font-size:10px;color:var(--white40);margin-bottom:3px;}
.list-footer{display:flex;align-items:center;gap:5px;flex-wrap:wrap;}
.list-rating{font-size:10px;font-weight:600;color:var(--gold);}
.list-visits{font-size:9px;color:var(--white40);background:var(--white10);padding:1px 5px;border-radius:8px;}
.badge{display:inline-flex;padding:1px 5px;border-radius:3px;font-size:8px;font-weight:800;text-transform:uppercase;letter-spacing:.5px;}
.badge-sponsored{background:rgba(212,168,71,.9);color:#000;}
.badge-featured{background:rgba(232,20,42,.9);color:#fff;}
.badge-deal{background:rgba(34,197,94,.9);color:#000;}
.badge-new{background:rgba(99,102,241,.9);color:#fff;}
.map-popup{position:absolute;z-index:500;bottom:80px;left:50%;transform:translateX(-50%);width:calc(100% - 32px);max-width:340px;display:none;pointer-events:none;}
.map-popup.show{display:block;pointer-events:auto;}
.popup-card{background:var(--black2);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;box-shadow:0 8px 32px rgba(0,0,0,.8);}
.popup-img{width:100%;height:120px;object-fit:cover;display:block;}
.popup-body{padding:10px 14px;}
.popup-top{display:flex;align-items:flex-start;gap:8px;margin-bottom:8px;}
.popup-name{font-size:14px;font-weight:700;flex:1;}
.popup-close{background:var(--white10);border:none;border-radius:50%;width:26px;height:26px;color:var(--white);cursor:pointer;font-size:14px;flex-shrink:0;}
.popup-meta{font-size:11px;color:var(--white40);margin-bottom:8px;}
.popup-stats{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.popup-rating{font-size:12px;font-weight:700;color:var(--gold);}
.popup-visits{font-size:11px;color:var(--white40);}
.popup-badges{display:flex;gap:4px;flex:1;justify-content:flex-end;}
.popup-actions{display:flex;gap:8px;}
.btn-view{flex:1;background:var(--red);color:var(--white);border:none;border-radius:6px;padding:8px;font-size:12px;font-weight:700;font-family:'DM Sans',sans-serif;cursor:pointer;text-align:center;text-decoration:none;display:block;}
.btn-save{background:var(--white10);color:var(--white);border:1px solid var(--border);border-radius:6px;padding:8px 12px;font-size:16px;cursor:pointer;}
.bottom-nav{position:fixed;bottom:0;left:0;right:0;z-index:90;background:var(--black2);border-top:1px solid var(--border);display:flex;padding:8px 0 calc(8px + env(safe-area-inset-bottom));}
.bnav-item{flex:1;display:flex;flex-direction:column;align-items:center;gap:2px;cursor:pointer;color:var(--white40);text-decoration:none;transition:color .2s;}
.bnav-item.active{color:var(--red);}
.bnav-icon{font-size:20px;}
.bnav-label{font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:.5px;}
@media(max-width:767px){
  .sidebar{display:none;}
  .map-popup{bottom:72px;width:calc(100% - 24px);}
  .filter-bar{padding:8px 12px;}
  .map-container{height:calc(100vh - 52px - 44px);}
}
</style>
</head>
<body>
<header>
  <div class="header-inner">
    <a href="index.html"><img src="./swanpass_logo_rev.png" alt="Swanpass" class="logo-img"></a>
    <div class="header-search" onclick="window.location='search.html?q='+encodeURIComponent(this.querySelector('input').value)" style="cursor:pointer">
      <span style="color:var(--white40)">ğŸ”</span>
      <input type="text" placeholder="Search shops, cities..." onclick="event.stopPropagation()" onkeydown="if(event.key='Enter')window.location='search.html?q='+encodeURIComponent(this.value)">
    </div>
    <button class="btn-menu">â˜°</button>
    <button class="btn-login" onclick="window.location='login.html'">Login</button>
  </div>
</header>
<nav class="nav-tabs">
  <div class="nav-tabs-inner">
    <a href="index.html" class="nav-tab">ğŸ  Home</a>
    <a href="map.html" class="nav-tab active">ğŸ—ºï¸ Map</a>
    <a href="deals.html" class="nav-tab">ğŸ·ï¸ Deals</a>
    <a href="listings.html" class="nav-tab">ğŸ” Browse</a>
    <a href="cities.html" class="nav-tab">ğŸ“ Cities</a>
    <a href="search.html" class="nav-tab">ğŸ” Search</a>
    <a href="add-listing.html" class="nav-tab">â• List Your Business</a>
    <a href="admin.html" class="nav-tab">âš™ï¸ Admin</a>
  </div>
</nav>
<div class="filter-bar">
  <div class="filter-search"><span style="font-size:12px;color:var(--white40)">ğŸ”</span><input type="text" placeholder="Search shops..." id="searchInput" oninput="renderMarkers()"></div>
  <div class="filter-divider"></div>
  <div class="filter-pill active" onclick="setCat(this,'all')">ğŸ”¥ All</div>
  <div class="filter-pill" onclick="setCat(this,'massage')">ğŸ‘„ Massage</div>
  <div class="filter-pill" onclick="setCat(this,'soapy')">ğŸ› Soapy</div>
  <div class="filter-pill" onclick="setCat(this,'club')">ğŸ’ƒ Club</div>
  <div class="filter-pill" onclick="setCat(this,'gogo')">ğŸ‘¯ Go-Go</div>
  <div class="filter-pill" onclick="setCat(this,'freelancer')">â¤ï¸â€ğŸ”¥ Freelancers</div>
  <div class="filter-pill" onclick="setCat(this,'redlight')">ğŸ“ Red Light</div>
  <div class="filter-divider"></div>
  <div class="filter-pill" id="tag-sponsored" onclick="toggleTag('sponsored')">ğŸ“£ Sponsored</div>
  <div class="filter-pill" id="tag-deal" onclick="toggleTag('deal')">ğŸ·ï¸ Deals</div>
</div>
<div class="main">
  <div id="map"></div>
  <div class="sidebar">
    <div class="sidebar-header">
      <div class="sidebar-title">Nearby Shops</div>
      <div class="result-count" id="resultCount">0 results</div>
    </div>
    <div class="sidebar-list" id="sidebarList"></div>
  </div>
  <div class="map-popup" id="mapPopup">
    <div class="popup-card">
      <img id="popupImg" class="popup-img" src="" alt="">
      <div class="popup-body">
        <div class="popup-top">
          <div>
            <div class="popup-name" id="popupName"></div>
            <div class="popup-meta" id="popupMeta"></div>
          </div>
          <button class="popup-close" onclick="closePopup()">âœ•</button>
        </div>
        <div class="popup-stats">
          <span class="popup-rating" id="popupRating"></span>
          <span class="popup-visits" id="popupVisits"></span>
          <div class="popup-badges" id="popupBadges"></div>
        </div>
        <div class="popup-actions">
          <a id="popupLink" href="#" class="btn-view">View Details â†’</a>
          <button class="btn-save">â™¡</button>
        </div>
      </div>
    </div>
  </div>
</div>
<nav class="bottom-nav">
  <a href="index.html" class="bnav-item"><span class="bnav-icon">ğŸ </span><span class="bnav-label">Home</span></a>
  <a href="map.html" class="bnav-item active"><span class="bnav-icon">ğŸ—ºï¸</span><span class="bnav-label">Map</span></a>
  <a href="index.html#deals" class="bnav-item"><span class="bnav-icon">ğŸ·ï¸</span><span class="bnav-label">Deals</span></a>
  <a href="listings.html" class="bnav-item"><span class="bnav-icon">ğŸ”</span><span class="bnav-label">Browse</span></a>
  <a href="admin.html" class="bnav-item"><span class="bnav-icon">âš™ï¸</span><span class="bnav-label">Admin</span></a>
</nav>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script>
const shops=[
  {id:1,name:'Chairman Nuru Massage',cat:'massage',emoji:'ğŸ‘„',city:'Bangkok',lat:13.7303,lng:100.5637,rating:4.9,visits:'9K+',tags:['sponsored','featured'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/14214/chairman-nuru.jpeg',page:'listing-chairman-nuru.html'},
  {id:2,name:'JSpot Massage',cat:'soapy',emoji:'ğŸ›',city:'Bangkok',lat:13.7295,lng:100.5645,rating:4.7,visits:'5K+',tags:['sponsored','deal'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/14639/S__6889528.jpg',page:'listing-jspot.html'},
  {id:3,name:'AMOR888',cat:'soapy',emoji:'ğŸ›',city:'Bangkok',lat:13.7267,lng:100.5602,rating:4.8,visits:'2K+',tags:['sponsored'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/14212/amor888.jpeg',page:'listing-amor888.html'},
  {id:4,name:'The333',cat:'soapy',emoji:'ğŸ›',city:'Bangkok',lat:13.7305,lng:100.5640,rating:4.8,visits:'2K+',tags:['featured','deal'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/14217/the333.jpeg',page:'listing-the333.html'},
  {id:5,name:'G2G Massage',cat:'massage',emoji:'ğŸ‘„',city:'Bangkok',lat:13.7301,lng:100.5630,rating:4.9,visits:'8K+',tags:['featured'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/14216/g2g-massage.jpeg',page:'#'},
  {id:6,name:'666 Class',cat:'massage',emoji:'ğŸ‘„',city:'Bangkok',lat:13.7292,lng:100.5628,rating:4.8,visits:'3K+',tags:['sponsored'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/14215/666-class.jpeg',page:'#'},
  {id:7,name:'DRAKE Luxury Lounge',cat:'club',emoji:'ğŸ’ƒ',city:'Bangkok',lat:13.7300,lng:100.5628,rating:4.2,visits:'<100',tags:['sponsored','new'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/15250/WhatsApp_Image_2026-02-23_at_16.12.33.webp',page:'#'},
  {id:8,name:'Don Quixote',cat:'massage',emoji:'ğŸ‘„',city:'Bangkok',lat:13.7286,lng:100.5621,rating:4.7,visits:'7K+',tags:['featured'],img:'https://swanpass.com/wp-content/uploads/2023/01/image09.jpg',page:'#'},
  {id:9,name:'Club Cozmo',cat:'club',emoji:'ğŸ’ƒ',city:'Bangkok',lat:13.7272,lng:100.5220,rating:4.5,visits:'4K+',tags:['featured'],img:'https://swanpass.com/wp-content/uploads/2023/05/room07-3.jpg',page:'#'},
  {id:10,name:'Taki',cat:'club',emoji:'ğŸ’ƒ',city:'Bangkok',lat:13.7298,lng:100.5701,rating:4.4,visits:'3K+',tags:[],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/8884/01.jpg',page:'#'},
  {id:11,name:'Flame Spa Seminyak',cat:'massage',emoji:'ğŸ‘„',city:'Bali',lat:-8.6835,lng:115.1586,rating:4.8,visits:'2K+',tags:['featured','deal'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/12090/seminyak.jpg2.jpg',page:'#'},
  {id:12,name:'Ibiza Spa',cat:'soapy',emoji:'ğŸ›',city:'Bali',lat:-8.7328,lng:115.1671,rating:4.6,visits:'1K+',tags:[],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/12102/Screenshot_2024-08-30_at_6.23.00_PM.jpg',page:'#'},
  {id:13,name:'Galaxy Walking St',cat:'gogo',emoji:'ğŸ‘¯',city:'Pattaya',lat:12.9275,lng:100.8780,rating:4.5,visits:'3K+',tags:['featured'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/813/314591480_681428673470423_3006201469555310398_n.jpg',page:'#'},
  {id:14,name:'Suwon Man\'s Spa',cat:'massage',emoji:'ğŸ‘„',city:'Bangkok',lat:13.7260,lng:100.5590,rating:4.3,visits:'7K+',tags:['sponsored'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/14615/Suwon.jpg',page:'#'},
  {id:15,name:'Lunar Nuru',cat:'soapy',emoji:'ğŸ›',city:'Bangkok',lat:13.7255,lng:100.5612,rating:4.9,visits:'100+',tags:['new','deal'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/15233/store01.jpg',page:'#'},
  {id:16,name:'Exotic Massage Bangkok',cat:'massage',emoji:'ğŸ‘„',city:'Bangkok',lat:13.7235,lng:100.5560,rating:4.8,visits:'9K+',tags:[],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/12049/2024-08-16-1.jpg',page:'#'},
  {id:17,name:'Dragon Lady BKK',cat:'massage',emoji:'ğŸ‘„',city:'Bangkok',lat:13.7320,lng:100.5670,rating:3.8,visits:'100+',tags:['new'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/15189/Screenshot_2026-01-23_at_5.39.54_PM.jpg',page:'#'},
  {id:18,name:'Riviere 77',cat:'massage',emoji:'ğŸ‘„',city:'Bangkok',lat:13.7218,lng:100.5880,rating:4.9,visits:'100+',tags:['new'],img:'https://sgp1.vultrobjects.com/swanprod/uploads/photo/image/15179/store01.jpg',page:'#'},
];

let activeCat='all',activeTags=new Set(),activeItem=null,markers=[];
const map=L.map('map',{center:[13.73,100.56],zoom:13,zoomControl:false});
L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png',{attribution:'Â© OpenStreetMap Â© CARTO',maxZoom:19}).addTo(map);
L.control.zoom({position:'bottomright'}).addTo(map);

function mkIcon(emoji,active){
  return L.divIcon({html:`<span class="emoji-pin" style="${active?'transform:scale(1.4);filter:drop-shadow(0 0 8px rgba(232,20,42,.9));':''}">${emoji}</span>`,iconSize:[32,32],iconAnchor:[16,16],className:''});
}

function renderMarkers(){
  markers.forEach(m=>map.removeLayer(m.layer));markers=[];
  const list=document.getElementById('sidebarList');list.innerHTML='';
  const q=document.getElementById('searchInput').value.toLowerCase();
  let count=0;
  shops.forEach(s=>{
    if(activeCat!=='all'&&s.cat!==activeCat)return;
    if(activeTags.size>0&&![...activeTags].every(t=>s.tags.includes(t)))return;
    if(q&&!s.name.toLowerCase().includes(q)&&!s.city.toLowerCase().includes(q))return;
    count++;
    const m=L.marker([s.lat,s.lng],{icon:mkIcon(s.emoji,false)}).addTo(map);
    m.on('click',()=>showPopup(s,m));
    markers.push({layer:m,shop:s});
    const div=document.createElement('div');
    div.className='list-item';div.id='li-'+s.id;
    div.innerHTML=`<img class="list-thumb" src="${s.img}" onerror="this.style.background='#2a1a1a';this.removeAttribute('src')">
    <div class="list-info">
      <div class="list-name">${s.name}</div>
      <div class="list-meta">${s.emoji} ${s.cat} Â· ğŸ“ ${s.city}</div>
      <div class="list-footer">
        <span class="list-rating">â˜… ${s.rating}</span>
        <span class="list-visits">${s.visits}</span>
        ${s.tags.includes('sponsored')?'<span class="badge badge-sponsored">Spons</span>':''}
        ${s.tags.includes('featured')?'<span class="badge badge-featured">â˜…</span>':''}
        ${s.tags.includes('deal')?'<span class="badge badge-deal">Deal</span>':''}
        ${s.tags.includes('new')?'<span class="badge badge-new">New</span>':''}
      </div>
    </div>`;
    div.onclick=()=>{map.setView([s.lat,s.lng],16);showPopup(s,m);};
    list.appendChild(div);
  });
  document.getElementById('resultCount').textContent=count+' results';
}

function showPopup(s,marker){
  if(activeItem){activeItem.layer.setIcon(mkIcon(activeItem.shop.emoji,false));document.getElementById('li-'+activeItem.shop.id)?.classList.remove('active');}
  marker.setIcon(mkIcon(s.emoji,true));activeItem={layer:marker,shop:s};
  document.getElementById('li-'+s.id)?.classList.add('active');
  document.getElementById('popupImg').src=s.img;
  document.getElementById('popupName').textContent=s.name;
  document.getElementById('popupMeta').textContent=s.emoji+' '+s.cat+' Â· ğŸ“ '+s.city;
  document.getElementById('popupRating').textContent='â˜… '+s.rating;
  document.getElementById('popupVisits').textContent=s.visits+' visits';
  document.getElementById('popupBadges').innerHTML=(s.tags.includes('sponsored')?'<span class="badge badge-sponsored">Sponsored</span>':'')+(s.tags.includes('deal')?'<span class="badge badge-deal">Deal</span>':'')+(s.tags.includes('new')?'<span class="badge badge-new">New</span>':'');
  document.getElementById('popupLink').href=s.page;
  document.getElementById('mapPopup').classList.add('show');
}
function closePopup(){
  document.getElementById('mapPopup').classList.remove('show');
  if(activeItem){activeItem.layer.setIcon(mkIcon(activeItem.shop.emoji,false));document.getElementById('li-'+activeItem.shop.id)?.classList.remove('active');activeItem=null;}
}
function setCat(el,cat){
  document.querySelectorAll('.filter-pill').forEach(p=>{if(p.id&&p.id.startsWith('tag-'))return;p.classList.remove('active');});
  el.classList.add('active');activeCat=cat;renderMarkers();
}
function toggleTag(tag){
  const el=document.getElementById('tag-'+tag);
  if(activeTags.has(tag)){activeTags.delete(tag);el.classList.remove('active');}
  else{activeTags.add(tag);el.classList.add('active');}
  renderMarkers();
}
map.on('click',()=>closePopup());
renderMarkers();
</script>
</body>
</html>
